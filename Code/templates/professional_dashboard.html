<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <!-- Welcome Message for Professional -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <span class="h4">Welcome, Professional {{ session['username'] }}!</span>
            <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
        </div>

        <!-- Dashboard Heading -->
        <h2 class="text-center mb-4">Professional Dashboard</h2>

        <!-- Pending Requests Section -->
        <h3 class="mb-4">Pending Requests for Your Service</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Service Name</th>
                        <th>User</th>
                        <th>Request Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in pending_requests %}
                        <tr>
                            <td>{{ request.service.sname }}</td>
                            <td>{{ request.user.fname }} {{ request.user.lname }}</td>
                            <td>{{ request.request_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                            <td>
                                <!-- Accept Request -->
                                <form method="POST" action="/professional/accept_request/{{ request.id }}" style="display:inline;">
                                    <button type="submit" class="btn btn-success btn-sm">Accept</button>
                                </form>
                                <!-- Reject Request -->
                                <form method="POST" action="/professional/reject_request/{{ request.id }}" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not pending_requests %}
                <div class="alert alert-warning text-center">No pending requests for your service.</div>
            {% endif %}
        </div>

        <!-- Accepted Requests Section -->
        <h3 class="mt-5">Accepted Requests</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Service Name</th>
                        <th>User</th>
                        <th>Status</th>
                        <th>Request Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for accepted_request in accepted_requests %}
                        <tr>
                            <td>{{ accepted_request.service.sname }}</td>
                            <td>{{ accepted_request.user.fname }} {{ accepted_request.user.lname }}</td>
                            <td>
                                <span class="badge bg-success">{{ accepted_request.status }}</span>
                            </td>
                            <td>{{ accepted_request.request_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                            <td>
                                {% if accepted_request.status == 'Accepted' %}
                                    <!-- Mark as Completed -->
                                    <form method="POST" action="/professional/complete_request/{{ accepted_request.id }}" style="display:inline;">
                                        <textarea 
                                            class="form-control" 
                                            name="professional_review" 
                                            placeholder="Write your review" 
                                            required></textarea>
                                        <button type="submit" class="btn btn-primary btn-sm mt-2">Submit Review & Mark as Completed</button>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not accepted_requests %}
                <div class="alert alert-warning text-center">No accepted requests.</div>
            {% endif %}
        </div>

        <!-- Completed and Closed Requests Section -->
        <h3 class="mt-5">Completed and Closed Requests</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Service Name</th>
                        <th>User</th>
                        <th>Status</th>
                        <th>Request Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for completed_request in completed_requests %}
                        <tr>
                            <td>{{ completed_request.service.sname }}</td>
                            <td>{{ completed_request.user.fname }} {{ completed_request.user.lname }}</td>
                            <td>
                                {% if completed_request.status == 'Completed' %}
                                    <span class="badge bg-primary">{{ completed_request.status }}</span>
                                {% elif completed_request.status == 'Closed' %}
                                    <span class="badge bg-secondary">{{ completed_request.status }}</span>
                                {% endif %}
                            </td>
                            <td>{{ completed_request.request_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if not completed_requests %}
                <div class="alert alert-warning text-center">No completed or closed requests.</div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
